Deploy:

-> % adk deploy cloud_run --help
Usage: adk deploy cloud_run [OPTIONS] AGENT

  Deploys agent to Cloud Run.

  AGENT: The path to the agent source code folder.

  Example:

    adk deploy cloud_run --project=[project] --region=[region] path/to/my_agent

Options:
  --project TEXT          Required. Google Cloud project to deploy the agent.
  --region TEXT           Required. Google Cloud region to deploy the agent.
  --service_name TEXT     Optional. The service name to use in Cloud Run (default: 'adk-default-service-name').
  --app_name TEXT         Optional. App name of the ADK API server (default: the folder name of the AGENT source code).
  --agent_engine_id TEXT  Optional. Set VertexAI Agent Engine resource ID to use managed session service.
  --port INTEGER          Optional. The port of the ADK API server (default: 8000).
  --with_ui               Optional. Deploy ADK Web UI if set. (default: deploy ADK API server only)
  --temp_folder TEXT      Optional. Temp folder for the generated Cloud Run source files (default: a timestamped folder in the system temp directory).
  --help                  Show this message and exit.


gcloud services enable cloudbuild.googleapis.com
gcloud services enable artifactregistry.googleapis.com
gcloud services enable cloudbuild.googleapis.com
gcloud services enable run.googleapis.com

gcloud config set project governed-data-1pqzajgatl
gcloud auth application-default set-quota-project governed-data-1pqzajgatl

GRANT vertex ai user to the Cloud Run service account



##########################################################################################
# Deploy
##########################################################################################

source .venv/bin/activate

export GOOGLE_GENAI_USE_VERTEXAI=True                   # We will use the Vertex AI endpoint and not the aistudio one
export GOOGLE_CLOUD_PROJECT="governed-data-1pqzajgatl"  # Project of Vertex and Cloud Run
export GOOGLE_CLOUD_LOCATION="us-central1"              # Region to deploy
export AGENT_PATH="./data_analytics_agent"              # Directory name
export SERVICE_NAME="data-analytics-agent-service-02"   # You can change on each deployment for A/B testing
export APP_NAME="data_analytics_agent"                  # This needs to the directory name

adk deploy cloud_run \
--project=$GOOGLE_CLOUD_PROJECT \
--region=$GOOGLE_CLOUD_LOCATION \
--service_name=$SERVICE_NAME \
--app_name=$APP_NAME \
--with_ui \
$AGENT_PATH

##########################################################################################
# NOTE: You need to get the Cloud Run URL
##########################################################################################
export APP_URL="https://data-analytics-agent-service-02-601982832853.us-central1.run.app"
export TOKEN=$(gcloud auth print-identity-token)
curl -X GET -H "Authorization: Bearer $TOKEN" $APP_URL/list-apps

curl -X POST -H "Authorization: Bearer $TOKEN" \
    $APP_URL/apps/data_analytics_agent/users/adam_p/sessions/session_01 \
    -H "Content-Type: application/json" \
    -d '{"state": {"preferred_language": "English", "visit_count": 0}}'

curl -X POST -H "Authorization: Bearer $TOKEN" \
    $APP_URL/run_sse \
    -H "Content-Type: application/json" \
    -d '{
    "app_name": "data_analytics_agent",
    "user_id": "adam_p",
    "session_id": "session_01",
    "new_message": {
        "role": "user",
        "parts": [{
        "text": "What is the capital of Florida?"
        }]
    },
    "streaming": false
    }'    

